<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website OSIS - Sistem Manajemen Tugas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #ffffff 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Efek Bokeh */
        .bokeh {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
        }

        .bokeh-circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(168, 230, 207, 0.3);
            animation: float 20s infinite ease-in-out;
        }

        .bokeh-circle:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .bokeh-circle:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            left: 80%;
            animation-delay: 3s;
        }

        .bokeh-circle:nth-child(3) {
            width: 100px;
            height: 100px;
            top: 80%;
            left: 20%;
            animation-delay: 6s;
        }

        .bokeh-circle:nth-child(4) {
            width: 60px;
            height: 60px;
            top: 30%;
            left: 70%;
            animation-delay: 9s;
        }

        .bokeh-circle:nth-child(5) {
            width: 90px;
            height: 90px;
            top: 50%;
            left: 50%;
            animation-delay: 12s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
                opacity: 0.3;
            }
            50% {
                transform: translateY(-30px) translateX(30px);
                opacity: 0.6;
            }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #4a9d7f;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #a8e6cf;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .login-container {
            max-width: 500px;
            margin: 80px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .login-container h2 {
            color: #4a9d7f;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #555;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #a8e6cf;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4a9d7f;
            box-shadow: 0 0 0 3px rgba(74, 157, 127, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #4a9d7f;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn:hover {
            background: #3d8268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 157, 127, 0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #a8e6cf;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: #4a9d7f;
        }

        .tab:hover {
            background: #a8e6cf;
            transform: translateY(-2px);
        }

        .tab.active {
            background: #4a9d7f;
            color: white;
            border-color: #4a9d7f;
        }

        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .struktur-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sekbid-card {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc8 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .sekbid-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .sekbid-card h3 {
            color: #2d5f4d;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .sekbid-card p {
            color: #555;
            font-size: 0.95em;
        }

        .task-list {
            margin-top: 20px;
        }

        .task-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #4a9d7f;
        }

        .task-item h4 {
            color: #4a9d7f;
            margin-bottom: 10px;
        }

        .task-item p {
            color: #666;
            margin-bottom: 8px;
        }

        .task-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .upload-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            margin-top: 10px;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 20px;
            background: #4a9d7f;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #3d8268;
        }

        .file-name {
            display: inline-block;
            margin-left: 10px;
            color: #666;
        }

        .upload-list {
            margin-top: 20px;
        }

        .upload-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .upload-info {
            flex-grow: 1;
        }

        .upload-info h5 {
            color: #4a9d7f;
            margin-bottom: 5px;
        }

        .upload-info small {
            color: #999;
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #ff5252;
        }

        .demo-info {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .demo-info strong {
            color: #1976D2;
        }

        .admin-section {
            margin-top: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4a9d7f 0%, #5fb890 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                justify-content: center;
            }

            .tab {
                font-size: 0.9em;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Efek Bokeh -->
    <div class="bokeh">
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
    </div>

    <!-- Login/Register Page -->
    <div id="loginPage" class="login-container">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: #4a9d7f; font-size: 2.2em; margin-bottom: 15px;">Welcome to</h1>
            <h2 style="color: #4a9d7f; font-size: 1.8em; margin-bottom: 25px;">Organisasi Intra Sekolah</h2>
            
            <div style="background: linear-gradient(135deg, #a8e6cf 0%, #dcedc8 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                <h3 style="color: #2d5f4d; margin-bottom: 15px; font-size: 1.2em;">Pengurus OSIS</h3>
                <div style="text-align: left; color: #555; line-height: 1.8;">
                    <p><strong style="color: #4a9d7f;">Ketua OSIS:</strong> Zahran Al Baihaqi</p>
                    <p><strong style="color: #4a9d7f;">Wakil Ketua OSIS:</strong> Ruby Jaharah</p>
                    <p><strong style="color: #4a9d7f;">Sekretaris:</strong> Faris Riyadi Irawan</p>
                    <p><strong style="color: #4a9d7f;">Bendahara:</strong> Muthia Aulia Hardiyanti</p>
                </div>
            </div>
        </div>
        
        <h2 id="authTitle">üéì Login OSIS</h2>
        
        <form id="loginForm">
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="username" placeholder="Masukkan username" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="Masukkan password" required>
            </div>
            <div class="form-group" id="nameField" style="display: none;">
                <label>Nama Lengkap</label>
                <input type="text" id="fullname" placeholder="Masukkan nama lengkap">
            </div>
            <div class="form-group" id="sekbidField" style="display: none;">
                <label>Sekbid</label>
                <select id="registerSekbid">
                    <option value="">-- Pilih Sekbid Anda --</option>
                </select>
            </div>
            <button type="submit" class="btn" id="authButton">Login</button>
        </form>
        
        <p style="text-align: center; margin-top: 20px; color: #666;">
            <span id="toggleText">Belum punya akun?</span> 
            <a href="#" onclick="toggleAuthMode(); return false;" style="color: #4a9d7f; font-weight: 600;">
                <span id="toggleLink">Daftar disini</span>
            </a>
        </p>
    </div>

    <!-- Main Page -->
    <div id="mainPage" class="hidden">
        <div class="container">
            <div class="header">
                <h1>üéì Website OSIS</h1>
                <p>Sistem Manajemen Tugas & Organisasi</p>
                <div class="user-info">
                    <div>
                        <strong id="displayName"></strong> | <span id="displayRole"></span>
                        <span id="displaySekbid"></span>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="showTab('struktur')">üìã Struktur Organisasi</div>
                <div class="tab" onclick="showTab('tugas')">‚úÖ Tugas Sekbid</div>
                <div class="tab" onclick="showTab('upload')">üì§ Upload Laporan</div>
                <div class="tab admin-only hidden" onclick="showTab('admin')">‚öôÔ∏è Admin Panel</div>
            </div>

            <!-- Struktur Organisasi -->
            <div id="struktur" class="content-section active">
                <h2 style="color: #4a9d7f; margin-bottom: 20px;">Struktur Organisasi OSIS</h2>
                <div class="struktur-grid" id="strukturGrid"></div>
            </div>

            <!-- Tugas Sekbid -->
            <div id="tugas" class="content-section">
                <h2 style="color: #4a9d7f; margin-bottom: 20px;">Tugas Sekbid</h2>
                <div class="form-group">
                    <label>Pilih Sekbid:</label>
                    <select id="sekbidSelect" onchange="loadTasks()">
                        <option value="">-- Pilih Sekbid --</option>
                    </select>
                </div>
                <div class="task-list" id="taskList"></div>
            </div>

            <!-- Upload Laporan -->
            <div id="upload" class="content-section">
                <h2 style="color: #4a9d7f; margin-bottom: 20px;">Upload Laporan Tugas</h2>
                
                <div class="upload-section">
                    <div class="form-group">
                        <label>Pilih Sekbid:</label>
                        <select id="uploadSekbidSelect">
                            <option value="">-- Pilih Sekbid --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Pilih Tugas:</label>
                        <select id="uploadTaskSelect">
                            <option value="">-- Pilih Tugas --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Keterangan:</label>
                        <input type="text" id="uploadDescription" placeholder="Deskripsi laporan...">
                    </div>

                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" onchange="updateFileName()">
                        <label for="fileInput" class="file-input-label">üìÅ Pilih File</label>
                        <span class="file-name" id="fileName">Belum ada file dipilih</span>
                    </div>

                    <button class="btn" onclick="uploadFile()" style="margin-top: 20px;">Upload Laporan</button>
                </div>

                <h3 style="color: #4a9d7f; margin-top: 30px;">Laporan yang Sudah Diupload</h3>
                <div class="upload-list" id="uploadList"></div>
            </div>

            <!-- Admin Panel -->
            <div id="admin" class="content-section admin-only">
                <h2 style="color: #4a9d7f; margin-bottom: 20px;">Admin Panel</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalSekbid">10</h3>
                        <p>Total Sekbid</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalTasks">0</h3>
                        <p>Total Tugas</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalUploads">0</h3>
                        <p>Total Upload</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="completedTasks">0</h3>
                        <p>Tugas Selesai</p>
                    </div>
                </div>

                <div class="admin-section">
                    <h3 style="color: #4a9d7f; margin-bottom: 15px;">Tambah Tugas Baru</h3>
                    <div class="upload-section">
                        <div class="form-group">
                            <label>Sekbid:</label>
                            <select id="adminSekbidSelect"></select>
                        </div>
                        <div class="form-group">
                            <label>Nama Tugas:</label>
                            <input type="text" id="taskName" placeholder="Contoh: Membuat Proposal Kegiatan">
                        </div>
                        <div class="form-group">
                            <label>Deskripsi:</label>
                            <input type="text" id="taskDesc" placeholder="Detail tugas...">
                        </div>
                        <div class="form-group">
                            <label>Deadline:</label>
                            <input type="date" id="taskDeadline">
                        </div>
                        <button class="btn" onclick="addTask()">Tambah Tugas</button>
                    </div>
                </div>

                <div class="admin-section">
                    <h3 style="color: #4a9d7f; margin-bottom: 15px;">Semua Upload dari Anggota</h3>
                    <div class="upload-list" id="adminUploadList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Sekbid
        const sekbidList = [
            { id: 1, name: "Sekbid 1 - Agama", desc: "Bidang Keagamaan dan Ketaqwaan" },
            { id: 2, name: "Sekbid 2 - Budi Pekerti", desc: "Bidang Budi Pekerti dan Akhlak" },
            { id: 3, name: "Sekbid 3 - Kewarganegaraan", desc: "Bidang Kewarganegaraan dan Kepribadian" },
            { id: 4, name: "Sekbid 4 - Prestasi/Olahraga", desc: "Bidang Prestasi dan Olahraga" },
            { id: 5, name: "Sekbid 5 - Demokrasi", desc: "Bidang Demokrasi dan Kepemimpinan" },
            { id: 6, name: "Sekbid 6 - Kreatif", desc: "Bidang Kreativitas dan Kewirausahaan" },
            { id: 7, name: "Sekbid 7 - Kesehatan", desc: "Bidang Kesehatan dan Lingkungan" },
            { id: 8, name: "Sekbid 8 - Seni Budaya", desc: "Bidang Seni dan Budaya" },
            { id: 9, name: "Sekbid 9 - Informasi dan Komunikasi", desc: "Bidang Teknologi Informasi" },
            { id: 10, name: "Sekbid 10 - Bahasa Asing", desc: "Bidang Bahasa dan Literasi" }
        ];

        // Initialize localStorage
        if (!localStorage.getItem('osisTasks')) {
            localStorage.setItem('osisTasks', JSON.stringify([]));
        }
        if (!localStorage.getItem('osisUploads')) {
            localStorage.setItem('osisUploads', JSON.stringify([]));
        }
        if (!localStorage.getItem('osisUsers')) {
            // Initialize with default admin account
            localStorage.setItem('osisUsers', JSON.stringify([
                {
                    username: 'admin',
                    password: 'admin123',
                    name: 'Administrator',
                    role: 'Admin',
                    sekbid: ''
                }
            ]));
        }

        // Auth mode state
        let isRegisterMode = false;

        // Toggle between Login and Register
        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            const authTitle = document.getElementById('authTitle');
            const authButton = document.getElementById('authButton');
            const nameField = document.getElementById('nameField');
            const sekbidField = document.getElementById('sekbidField');
            const toggleText = document.getElementById('toggleText');
            const toggleLink = document.getElementById('toggleLink');

            if (isRegisterMode) {
                authTitle.textContent = 'üìù Daftar Akun OSIS';
                authButton.textContent = 'Daftar';
                nameField.style.display = 'block';
                sekbidField.style.display = 'block';
                toggleText.textContent = 'Sudah punya akun?';
                toggleLink.textContent = 'Login disini';
                
                // Populate sekbid select for registration
                const select = document.getElementById('registerSekbid');
                select.innerHTML = '<option value="">-- Pilih Sekbid Anda --</option>';
                sekbidList.forEach(sekbid => {
                    const option = document.createElement('option');
                    option.value = sekbid.id;
                    option.textContent = sekbid.name;
                    select.appendChild(option);
                });
            } else {
                authTitle.textContent = 'üéì Login OSIS';
                authButton.textContent = 'Login';
                nameField.style.display = 'none';
                sekbidField.style.display = 'none';
                toggleText.textContent = 'Belum punya akun?';
                toggleLink.textContent = 'Daftar disini';
            }

            // Clear form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('fullname').value = '';
            document.getElementById('registerSekbid').value = '';
        }

        // Login/Register Function
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (isRegisterMode) {
                // Registration
                const fullname = document.getElementById('fullname').value.trim();
                const sekbidId = document.getElementById('registerSekbid').value;

                if (!fullname) {
                    alert('Nama lengkap harus diisi!');
                    return;
                }

                if (!sekbidId) {
                    alert('Silakan pilih sekbid!');
                    return;
                }

                if (username.length < 4) {
                    alert('Username minimal 4 karakter!');
                    return;
                }

                if (password.length < 6) {
                    alert('Password minimal 6 karakter!');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('osisUsers')) || [];
                
                // Check if username already exists
                if (users.some(u => u.username === username)) {
                    alert('Username sudah digunakan! Silakan pilih username lain.');
                    return;
                }

                const sekbid = sekbidList.find(s => s.id == sekbidId);

                // Create new user
                const newUser = {
                    username: username,
                    password: password,
                    name: fullname,
                    role: 'Anggota',
                    sekbid: sekbid.name
                };

                users.push(newUser);
                localStorage.setItem('osisUsers', JSON.stringify(users));

                alert('‚úÖ Akun berhasil dibuat! Silakan login.');
                toggleAuthMode();

            } else {
                // Login
                const users = JSON.parse(localStorage.getItem('osisUsers')) || [];
                const user = users.find(u => u.username === username && u.password === password);

                if (user) {
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    showMainPage();
                } else {
                    alert('Username atau password salah!');
                }
            }
        });

        // Show Main Page
        function showMainPage() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) {
                location.reload();
                return;
            }

            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('displayName').textContent = user.name;
            document.getElementById('displayRole').textContent = user.role;
            
            // Show sekbid for members
            const displaySekbid = document.getElementById('displaySekbid');
            if (user.sekbid) {
                displaySekbid.textContent = ` | ${user.sekbid}`;
            } else {
                displaySekbid.textContent = '';
            }

            // Show admin features if admin
            if (user.role === 'Admin') {
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.classList.remove('hidden');
                });
            }

            loadStruktur();
            populateSelects();
            loadUploads();
            updateStats();
        }

        // Logout
        function logout() {
            localStorage.removeItem('currentUser');
            location.reload();
        }

        // Tab Navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'upload') {
                loadUploads();
            } else if (tabName === 'admin') {
                loadAdminUploads();
                updateStats();
            }
        }

        // Load Struktur
        function loadStruktur() {
            const grid = document.getElementById('strukturGrid');
            grid.innerHTML = '';

            sekbidList.forEach(sekbid => {
                const card = document.createElement('div');
                card.className = 'sekbid-card';
                card.innerHTML = `
                    <h3>${sekbid.name}</h3>
                    <p>${sekbid.desc}</p>
                `;
                grid.appendChild(card);
            });
        }

        // Populate Selects
        function populateSelects() {
            const selects = [
                document.getElementById('sekbidSelect'),
                document.getElementById('uploadSekbidSelect'),
                document.getElementById('adminSekbidSelect')
            ];

            selects.forEach(select => {
                select.innerHTML = '<option value="">-- Pilih Sekbid --</option>';
                sekbidList.forEach(sekbid => {
                    const option = document.createElement('option');
                    option.value = sekbid.id;
                    option.textContent = sekbid.name;
                    select.appendChild(option);
                });
            });

            // Event listener for upload sekbid select
            document.getElementById('uploadSekbidSelect').addEventListener('change', function() {
                loadTasksForUpload(this.value);
            });
        }

        // Load Tasks
        function loadTasks() {
            const sekbidId = document.getElementById('sekbidSelect').value;
            const taskList = document.getElementById('taskList');

            if (!sekbidId) {
                taskList.innerHTML = '<p style="color: #999;">Silakan pilih sekbid terlebih dahulu</p>';
                return;
            }

            const tasks = JSON.parse(localStorage.getItem('osisTasks')) || [];
            const filteredTasks = tasks.filter(t => t.sekbidId == sekbidId);

            if (filteredTasks.length === 0) {
                taskList.innerHTML = '<p style="color: #999;">Belum ada tugas untuk sekbid ini</p>';
                return;
            }

            taskList.innerHTML = '';
            filteredTasks.forEach(task => {
                const uploads = JSON.parse(localStorage.getItem('osisUploads')) || [];
                const hasUpload = uploads.some(u => u.taskId === task.id);
                
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `
                    <h4>${task.name}</h4>
                    <p>${task.description}</p>
                    <p><strong>Deadline:</strong> ${task.deadline}</p>
                    <span class="task-status ${hasUpload ? 'status-completed' : 'status-pending'}">
                        ${hasUpload ? '‚úÖ Sudah Upload' : '‚è≥ Belum Upload'}
                    </span>
                `;
                taskList.appendChild(taskItem);
            });
        }

        // Load Tasks for Upload
        function loadTasksForUpload(sekbidId) {
            const taskSelect = document.getElementById('uploadTaskSelect');
            taskSelect.innerHTML = '<option value="">-- Pilih Tugas --</option>';

            if (!sekbidId) return;

            const tasks = JSON.parse(localStorage.getItem('osisTasks')) || [];
            const filteredTasks = tasks.filter(t => t.sekbidId == sekbidId);

            filteredTasks.forEach(task => {
                const option = document.createElement('option');
                option.value = task.id;
                option.textContent = task.name;
                taskSelect.appendChild(option);
            });
        }

        // Update File Name Display
        function updateFileName() {
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName');
            
            if (fileInput.files.length > 0) {
                fileName.textContent = fileInput.files[0].name;
            } else {
                fileName.textContent = 'Belum ada file dipilih';
            }
        }

        // Upload File
        function uploadFile() {
            const sekbidId = document.getElementById('uploadSekbidSelect').value;
            const taskId = document.getElementById('uploadTaskSelect').value;
            const description = document.getElementById('uploadDescription').value;
            const fileInput = document.getElementById('fileInput');

            if (!sekbidId || !taskId) {
                alert('Silakan pilih sekbid dan tugas!');
                return;
            }

            if (!fileInput.files.length) {
                alert('Silakan pilih file!');
                return;
            }

            const user = JSON.parse(localStorage.getItem('currentUser'));
            const tasks = JSON.parse(localStorage.getItem('osisTasks')) || [];
            const task = tasks.find(t => t.id == taskId);
            const sekbid = sekbidList.find(s => s.id == sekbidId);

            const upload = {
                id: Date.now(),
                taskId: parseInt(taskId),
                taskName: task.name,
                sekbidName: sekbid.name,
                fileName: fileInput.files[0].name,
                description: description || 'Tidak ada keterangan',
                uploadedBy: user.name,
                uploadDate: new Date().toLocaleString('id-ID')
            };

            const uploads = JSON.parse(localStorage.getItem('osisUploads')) || [];
            uploads.push(upload);
            localStorage.setItem('osisUploads', JSON.stringify(uploads));

            alert('‚úÖ File berhasil diupload!');
            
            // Reset form
            document.getElementById('uploadSekbidSelect').value = '';
            document.getElementById('uploadTaskSelect').value = '';
            document.getElementById('uploadDescription').value = '';
            fileInput.value = '';
            document.getElementById('fileName').textContent = 'Belum ada file dipilih';

            loadUploads();
        }

        // Load Uploads
        function loadUploads() {
            const uploadList = document.getElementById('uploadList');
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const uploads = JSON.parse(localStorage.getItem('osisUploads')) || [];

            // Filter uploads by current user if not admin
            const userUploads = user.role === 'Admin' 
                ? uploads 
                : uploads.filter(u => u.uploadedBy === user.name);

            if (userUploads.length === 0) {
                uploadList.innerHTML = '<p style="color: #999;">Belum ada laporan yang diupload</p>';
                return;
            }

            uploadList.innerHTML = '';
            userUploads.forEach(upload => {
                const uploadItem = document.createElement('div');
                uploadItem.className = 'upload-item';
                uploadItem.innerHTML = `
                    <div class="upload-info">
                        <h5>${upload.taskName}</h5>
                        <p>${upload.sekbidName}</p>
                        <p><strong>File:</strong> ${upload.fileName}</p>
                        <p><strong>Keterangan:</strong> ${upload.description}</p>
                        <small>Diupload: ${upload.uploadDate}</small>
                    </div>
                    <button class="delete-btn" onclick="deleteUpload(${upload.id})">Hapus</button>
                `;
                uploadList.appendChild(uploadItem);
            });
        }

        // Load Admin Uploads
        function loadAdminUploads() {
            const adminUploadList = document.getElementById('adminUploadList');
            const uploads = JSON.parse(localStorage.getItem('osisUploads')) || [];

            if (uploads.length === 0) {
                adminUploadList.innerHTML = '<p style="color: #999;">Belum ada laporan yang diupload</p>';
                return;
            }

            adminUploadList.innerHTML = '';
            uploads.forEach(upload => {
                const uploadItem = document.createElement('div');
                uploadItem.className = 'upload-item';
                uploadItem.innerHTML = `
                    <div class="upload-info">
                        <h5>${upload.taskName}</h5>
                        <p>${upload.sekbidName}</p>
                        <p><strong>File:</strong> ${upload.fileName}</p>
                        <p><strong>Keterangan:</strong> ${upload.description}</p>
                        <p><strong>Oleh:</strong> ${upload.uploadedBy}</p>
                        <small>Diupload: ${upload.uploadDate}</small>
                    </div>
                    <button class="delete-btn" onclick="deleteUpload(${upload.id})">Hapus</button>
                `;
                adminUploadList.appendChild(uploadItem);
            });
        }

        // Delete Upload
        function deleteUpload(uploadId) {
            if (!confirm('Yakin ingin menghapus upload ini?')) return;

            let uploads = JSON.parse(localStorage.getItem('osisUploads')) || [];
            uploads = uploads.filter(u => u.id !== uploadId);
            localStorage.setItem('osisUploads', JSON.stringify(uploads));

            loadUploads();
            loadAdminUploads();
            updateStats();
            alert('Upload berhasil dihapus!');
        }

        // Add Task (Admin)
        function addTask() {
            const sekbidId = document.getElementById('adminSekbidSelect').value;
            const taskName = document.getElementById('taskName').value;
            const taskDesc = document.getElementById('taskDesc').value;
            const taskDeadline = document.getElementById('taskDeadline').value;

            if (!sekbidId || !taskName || !taskDeadline) {
                alert('Silakan lengkapi semua field!');
                return;
            }

            const task = {
                id: Date.now(),
                sekbidId: parseInt(sekbidId),
                name: taskName,
                description: taskDesc || 'Tidak ada deskripsi',
                deadline: taskDeadline
            };

            const tasks = JSON.parse(localStorage.getItem('osisTasks')) || [];
            tasks.push(task);
            localStorage.setItem('osisTasks', JSON.stringify(tasks));

            alert('‚úÖ Tugas berhasil ditambahkan!');
            
            // Reset form
            document.getElementById('adminSekbidSelect').value = '';
            document.getElementById('taskName').value = '';
            document.getElementById('taskDesc').value = '';
            document.getElementById('taskDeadline').value = '';

            updateStats();
        }

        // Update Stats
        function updateStats() {
            const tasks = JSON.parse(localStorage.getItem('osisTasks')) || [];
            const uploads = JSON.parse(localStorage.getItem('osisUploads')) || [];

            document.getElementById('totalSekbid').textContent = sekbidList.length;
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('totalUploads').textContent = uploads.length;

            // Count completed tasks (tasks that have uploads)
            const completedTaskIds = [...new Set(uploads.map(u => u.taskId))];
            document.getElementById('completedTasks').textContent = completedTaskIds.length;
        }

        // Check if user is logged in on page load
        window.addEventListener('load', function() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user) {
                showMainPage();
            }
        });
    </script>
</body>
</html>